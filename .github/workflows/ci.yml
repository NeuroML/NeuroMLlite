name: Continuous builds

on:
  push:
    branches: [ master, development, experimental, only_black ]
  pull_request:
    branches: [ master, development, experimental, only_black ]

jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.7,3.9]
    env:
      JNML_HOME: "${GITHUB_WORKSPACE}/jNeuroML"

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python  ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version:  ${{ matrix.python-version }}

    - name: Install package
      run: |
        python -m pip install --upgrade pip
        pip install flake8
        pip install matplotlib==2.2.5 cachetools==3.1.1 # for testing python 2.7 & GH actions fails...
        pip install pyelectro
        pip install .

    - name: Lint with flake8
      run: |
        flake8 . --count --exit-zero --show-source --max-line-length=127 --statistics

    - name: Install correct branch of pyneuroml etc.
      run: |
        env
        # Check to see if on development/experimental branches
        export jnml_branches="development"
        export pynml_branch="master"
        echo "JNML_HOME: $env.JNML_HOME"
